# 教务系统课程信息爬取
> 昨夜武汉的雪很大，银装素裹的地大估计很难再见到了。周末无事，虽然教务系统的数据爬取价值不大，但是想看看新的教务系统与原来的信息组织方式有无改变。
## 页面数据请求分析
前面的验证登录的模拟什么的很简单我就不说了，直接分析页面:

不得不承认chales是一个很不错的抓包分析软件。通过它很容易地找到了教务系统（选课模块）的数据规律:
![](https://ws1.sinaimg.cn/large/6af92b9fly1fnvmtp0svhj20o10ft0vg.jpg)

可以看出提交查询课程信息的form的重要字段：
第一个是年级信息，第二个是学院代号（我校分机构有不同的代号，从01到80不等），第三个是是否有余量。剩下的就是关于个人或者课程类型的字段。我们可以根据需要设置不同的字段变量。具体有哪些可以选择可以对照着原始页面。

下面可以看出返回的课程信息格式是json，嗯这就比较好处理了。

下拉页面，这是一个典型的ajax感应渲染的技术：
![](https://ws1.sinaimg.cn/large/6af92b9fly1fnvmy1kw3qj20n00a6q38.jpg)

再次对比form发现控制此项的参数：
![](https://ws1.sinaimg.cn/large/6af92b9fly1fnvmzb25wtj209j02e3yd.jpg)

不得不说开发人员起名字太随意了，用拼音的规格还不统一，有时候声母是两个字母有时候用一个，根本没法儿猜意思嘛！

好吧，上面那个是起始数量，下面是结束数量，我们可以直接设置为全部，或者循环询问是否返回数据为空进行控制，无所谓。

页面就差不多分析完了，很简单很实用的一个方式。原先的教务系统用的技术较为复杂且不方便，这样一来就很容易跨专业选课了。
## 爬取策略
教师信息需要点击课程下来出来，这一步仍然是个ajax请求，抓包分析：

![](https://ws1.sinaimg.cn/large/6af92b9fly1fnvn5svrggj20ez0cz3z5.jpg)

不扯没用的，有用的就一个课程id。下面的返回的仍然是json格式。

好的，爬行策略：
- 设置cookies等模拟登陆
- requests模块创建session会话 保存访问信息
- 设置参数，抓取目标课程id
- 根据Id 抓取教师信息
- 最终一条课程包含：名称，教师信息，上课时间、地点等 存为一定格式。

> 写完这个文档已经深夜一点了。武汉的冬天真的冷.....但愿明天雪都化了吧，外卖可以上班....逃)